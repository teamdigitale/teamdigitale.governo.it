{% assign t = site.data.t %}
{% assign teamexpenses = site.data.expenses.SpeseDelTeam %}
{% assign detailedexpenses = site.data.expenses.SpeseAnalitiche %}
{% assign speseupdate = site.data.expenses.SpeseUpdate %}
{% assign sum_teamexpenses_impegno = 0 %}
{% assign sum_teamexpenses_pagamenti = 0 %}

<i>Dati aggiornati al {{speseupdate}}</i>

<table class="table table-striped expenses__teamexpenses">
    <thead>
      <tr>
        <th>Tipologia di spesa per macroarea</th>
        <th>Impegno iva inclusa</th>
        <th>Pagamenti</th>
      </tr>
    </thead>
    <tbody>
      {% for expense in teamexpenses %}
	      {% assign sum_teamexpenses_impegno = sum_teamexpenses_impegno | plus: expense.impegno  %}
	      {% assign sum_teamexpenses_pagamenti = sum_teamexpenses_pagamenti | plus: expense.pagamenti  %}
	      <tr>
	        <td>{{expense.voce}}</td>
	        <td><span class="white-space--nowrap">&euro; {{expense.impegno | intcomma}}</span></td>
	        <td><span class="white-space--nowrap">&euro; {{expense.pagamenti | intcomma}}</span></td>
	      </tr>
      {% endfor %}
    </tbody>
    <tfoot>
      	<tr>
      		<td><i>Totale</i></td>
      		<td><i>&euro; {{ sum_teamexpenses_impegno  | intcomma}}</i></td>
      		<td><i>&euro; {{ sum_teamexpenses_pagamenti  | intcomma}}</i></td>
      	</tr>
    </tfoot>
</table>

<h4>Dettaglio spese di sviluppo software e design superiori a EUR 30.000</h4>
<div class="panel-group" id="detailedaccordion" role="tablist" aria-multiselectable="true">
{% for expense in detailedexpenses %}
	<div class="panel panel-default expenses__detailedexpenses">
	  <div class="panel-heading" role="tab">
	    <h3 class="panel-title">
	    <a role="button" data-toggle="collapse" data-parent="#detailedaccordion" href="#detail{{forloop.index}}" 
	       aria-expanded="{% if forloop.first %}true{% else %}false{% endif %}" aria-controls="detail{{forloop.index}}">
	    {{expense.titolobreve}}
		</a>
		{% if expense.ref %}
		{% assign same_lang_pages = site.pages | where: "lang", page.lang %}
		{% assign proj_pages = same_lang_pages | where: "ref", expense.ref %}
		{% assign proj = proj_pages | first %}
		&nbsp;->&nbsp;
		<a href="{{proj.permalink | default: '#'}}" title="{{proj.title | default: expense.progetto}}">{{expense.progetto}}</a>
		{% endif %}
	    </h3>
	  </div>
	  <div id="detail{{forloop.index}}" class="panel-collapse collapse {% if forloop.first %}in{% endif %}" 
	  		role="tabpanel" aria-labelledby="heading{{forloop.index}}">
	  <div class="panel-body">
	  	<h4>{{expense.voce}}</h4>
	    <p>{{expense.descrizione}}</p>
	    <table class="table table-condensed">
	    	<thead>
	    		<tr>
	    		<th>Impegno iva inclusa</th>
        		<th>Pagamenti</th>
	    		<th>Contratto/accordo</th>
	    		</tr>
	    	</thead>
	    	<tbody>
	    		<tr>
	    		<td><span class="white-space--nowrap">&euro; {{expense.impegno | intcomma}}</span></td>
	        	<td><span class="white-space--nowrap">&euro; {{expense.pagamenti | intcomma}}</span></td>
	        	<td>{{expense.contraccordi}}</td>
	        	</tr>
	    	</tbody>
	    </table>
	  </div>
		</div>
	</div>

{% endfor %}
</div>